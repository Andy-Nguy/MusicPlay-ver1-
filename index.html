<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Duy Anh Nguyen</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin="anonymous" />
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="player">
    <!-- Dashboard -->
    <div class="dashboard">
        <div class="content">
            <!-- Header -->
            <header>
              <h4>Now playing:</h4>
              <h2></h2>
            </header>
      <!-- CD -->
      <div class="cd">
        <div class="cd-thumb" style="background-image: url('https://gocdoday.com/wp-content/uploads/2022/12/thumb-28-1024x576.jpg')">
        </div>
      </div>
           
          <!-- Control -->
          <div class="control">
            <div class="btn btn-repeat">
              <i class="fas fa-redo"></i>
            </div>
            <div class="btn btn-prev">
              <i class="fas fa-step-backward"></i>
            </div>
            
              <div class="btn btn-toggle-play">
               
                  <i class="fas fa-pause icon-pause"></i>
                  <i class="fas fa-play icon-play"></i>
               
           
            </div>
            <div class="btn btn-next">
              <i class="fas fa-step-forward"></i>
            </div>
            <div class="btn btn-random">
              <i class="fas fa-random"></i>
            </div>
          </div>
      
          <input id="progress" class="progress" type="range" value="0" step="1" min="0" max="100">
      
          <audio id="audio" src=""></audio>
        </div>
        </div>



  <!-- Playlist -->
  <div class="playlist">
    <div class="song">
      <div class="thumb" style="background-image: url('https://i.ytimg.com/vi/jTLhQf5KJSc/maxresdefault.jpg')">
      </div>
      <div class="body">
        <h3 class="title">Music name</h3>
        <p class="author">Singer</p>
      </div> 
      <div class="option">
        <i class="fas fa-ellipsis-h"></i>
      </div>
    </div>
    <div class="song">
      <div class="thumb" style="background-image: url('https://i.ytimg.com/vi/jTLhQf5KJSc/maxresdefault.jpg')">
      </div>
      <div class="body">
        <h3 class="title">Music name</h3>
        <p class="author">Singer</p>
      </div>
      <div class="option">
        <i class="fas fa-ellipsis-h"></i>
      </div>
    </div>
    <div class="song">
      <div class="thumb" style="background-image: url('')">
      </div>
      <div class="body">
        <h3 class="title">Music name</h3>
        <p class="author">Singer</p>
      </div>
      <div class="option">
        <i class="fas fa-ellipsis-h"></i>
      </div>
    </div>
  </div>
</div>


    

</body>
<!-- Design from: https://static.collectui.com/shots/3671744/musicloud-revolutionary-app-for-music-streaming-large -->
<script>
    const $=document.querySelector.bind(document)
    const $$=document.querySelector.bind(document)

    const cd=$('.cd')
    const heading=$('header h2')
    const cdThumb=$('.cd-thumb')
    const audio =$('#audio')
    const playBtn=$('.btn-toggle-play')
    const player =$('.player')
    const progress=$('#progress')
    const prevBtn=$('.btn-prev')
    const nextBtn=$('.btn-next')
    const ranBtn=$('.btn-random')
    const repeatBtn=$('.btn-repeat')
    const playlist=$('.playlist')

const app={
    currentIndex: 0,
    isPlaying:false,
    isRandom:false,
    isReapet:false,
    songs:[
    {
        name:'Để tôi ôm em bằng giai điệu này',
        singer: 'KAI DINH X MIN',
        path:'./assests/music/song1.mp3',
        image: './assests/image/thumb-28.jpg'
    },
    {
        name:'Là Anh',
        singer: 'PhucXp',
        path:'./assests/music/song2.mp3',
        image: './assests/image/thumb-29.jpg'
    },
    {
        name:'Gió ',
        singer: '911 X Đức Phúc',
        path:'./assests/music/song3.mp3',
        image: './assests/image/thumb-30.jpg'
    },
    {
        name:'Nợ Ai Đó Lời Xin Lỗi',
        singer: 'Bozitt',
        path:'./assests/music/song4.mp3',
        image: './assests/image/thumb-31.jpg'
    },
    {
        name:'Tự Sự',
        singer: 'Orange',
        path:'./assests/music/song5.mp3',
        image: './assests/image/thumb-32.jpg'
    },{
        name:'Thu Cuối',
        singer: 'Andiez',
        path:'./assests/music/song6.mp3',
        image: './assests/image/thumb-33.jpg'
    },
    {
      name:'4 Mùa Thương Em',
      singer: 'Lady Mây',
      path:'./assests/music/song7.mp3',
      image: './assests/image/thumb-34.jpg'
  },
  {
    name:'Nơi Này Có Anh',
    singer: 'Sơn Tùng MTP',
    path:'./assests/music/song8.mp3',
    image: './assests/image/thumb-35.jpg'
},
{
  name:'Chắc ai đó sẽ về',
  singer: 'Sơn Tùng MTP',
  path:'./assests/music/song9.mp3',
  image: './assests/image/thumb-36.jpg'
}, {
  name:'Vì anh đâu có biết',
  singer: 'Madihu',
  path:'./assests/music/song10.mp3',
  image: './assests/image/thumb-37.jpg'
}, {
  name:'Cô gái này là của ai',
  singer: ' Krix X Rush ft. Nhi Nhi',
  path:'./assests/music/song11.mp3',
  image: './assests/image/thumb-38.jpg'
},

{
  name:'Yêu Một Người Có Ước Mơ',
  singer: ' Bùi Trường Linh',
  path:'./assests/music/song15.mp3',
  image: './assests/image/thumb-42.jpg'
},
    ],
    render:function(){
        const htmls=this.songs.map((song, index) =>{
            return `
                <div class="song ${index === this.currentIndex ? 'active': ''}" data-index=${index}>
                    <div class="thumb" style="background-image: url('${song.image}')">
                    </div>
                    <div class="body">
                    <h3 class="title">${song.name}</h3>
                    <p class="author">${song.singer}</p>
                    </div>
                    <div class="option">
                    <i class="fas fa-ellipsis-h"></i>
                    </div>
                </div>
            `
        })
        playlist.innerHTML=htmls.join('')
    },
   
    handleEvents:function(){
       const _this=this
        const cdWidth =cd.offsetWidth
        // Xử lí CD rotate
      const cdThumbAnimate=cdThumb.animate ([
        {transform:'rotate(360deg)'}
      ],{
        duration:10000, //10 seconds
        iterations:Infinity
      })
      cdThumbAnimate.pause()
        document.onscroll=function(){
            const scrollTop=window.scrollY||document.documentElement.scrollTop
            const newCdWidth=cdWidth - scrollTop

            cd.style.width=newCdWidth >0 ? newCdWidth +'px': 0;
            cd.style.opacity=newCdWidth /cdWidth
        }

        // xử lí khi click play
        playBtn.onclick= function(){
          if(_this.isPlaying){
            audio.pause()
            player.classList.remove('playing')
          }else{
            audio.play()
          }
        }
        //khi play
        audio.onplay=function(){
          _this.isPlaying=true
          player.classList.add('playing')
          cdThumbAnimate.play()
        }
        // khi pause
        audio.onpause=function(){
          _this.isPlaying=false
          player.classList.remove('playing')
          cdThumbAnimate.pause()
        }
        //khi bai hát dc play
        audio.ontimeupdate=function(){
          if(audio.duration){
            const progressPercent=Math.floor(audio.currentTime/audio.duration*100)
            progress.value=progressPercent
          }
        }
        // Xử lí khi change
        progress.oninput=function(e){
           const seekTime=audio.duration/100*e.target.value
           audio.currentTime=seekTime
        }
        // Khi next songs
        nextBtn.onclick=function(){
          if(_this.isRandom){
            _this.randomSong()}
          else{
            _this.nextSong()
         }
          audio.play()
          _this.render()
          _this.scrollTopActiveSong()
        }
        //khi prev songs
        prevBtn.onclick=function(){
         if(_this.isRandom){
           _this.randomSong()}
         else{
            _this.prevSong()
         }
          audio.play()
        }
        // Khi random 
      ranBtn.onclick=function(e){
          _this.isRandom=!_this.isRandom
        ranBtn.classList.toggle('active',_this.isRandom)
       }
       //Xử lí next song khi audio ended
       audio.onended=function(){
        if(_this.isReapet){
          audio.play()
        }else
          nextBtn.click ()
       }
       // click vào playlist để next
       playlist.onclick=function(e){
            if (e.target.closest('.song:not(.active )') ||
                !e.target.closest('.option')
           ){
              if(e.target.closest('.song:not(.active )')){
                _this.currentIndex=Number(e.target.closest('.song:not(.active )').dataset.index)
                _this.loadCurentSong()
                _this.render()
                audio.play()
              }
           }
       },
       //khi click vào repeat
       repeatBtn.onclick=function(e){
          _this.isReapet=!_this.isReapet
        repeatBtn.classList.toggle('active',_this.isReapet)
       }
      },
      defineProperties: function(){
        Object.defineProperty(this,'currentSong',{
          get:function(){
            return this.songs[this.currentIndex]
          }
        })
      },
      loadCurentSong:function(){
        
        heading.textContent =this.currentSong.name
        cdThumb.style.backgroundImage=`url('${this.currentSong.image}')`
        audio.src=this.currentSong.path
      },
      //next music
      nextSong: function(){
        this.currentIndex++
        if(this.currentIndex >= this.songs.length){
           this.currentIndex = 0
        }
           this.loadCurentSong()
      },
      // previous music
      prevSong: function(){
        this.currentIndex--
        if(this.currentIndex <0){
           this.currentIndex =this.songs.length-1
        }
           this.loadCurentSong()
      },
      randomSong:function(){
        let newIndex
        do{
          newIndex=Math.floor(Math.random()*this.songs.length)
        }while(newIndex===this.currentIndex)
        this.currentIndex=newIndex
        this.loadCurentSong()
      },
      scrollTopActiveSong:function(){
        setTimeout(()=>{
          $('.song.active').scrollIntoView({
          behavior:'smooth',
          block:'nearest',
          })
        },400)
      },
    start:  function(){
      //định nghĩa các thuộc tính cho object
      this.defineProperties()
      // render lại playlist
      this.render()
      
      //load thông tin bài hát vào UI
      this.loadCurentSong()
      //lắng nghe các sự kiện
      this.handleEvents()
    }
}

    app.start()
</script>